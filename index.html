<html>

<head>
    <title>Caliper JS Sensor Test Page</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
    <script src="dist/caliperSensor-0.1.0.js"></script>
</head>

<body>
    <h1>Caliper JS Sensor Test</h1>

    <script type="text/javascript">
    $(document).ready(function() {

        // Initialize sensor with options
        var sensor = Caliper.Sensor;

        sensor.initialize({
            host: '127.0.0.1',
            port: '8070',
            path: '/v1custom/eventdata'
        });

        // The Actor for the Caliper Event
        var actor = new Caliper.Person("https://some-university.edu/user/554433");
        actor.setDateModified(1402965614516);

        // The Action for the Caliper Event
        var action = Caliper.ReadingActions.NAVIGATED_TO;

        // The Object being interacted with by the Actor
        var eventObj = new Caliper.EPubVolume("https://github.com/readium/readium-js-viewer/book/34843#epubcfi(/4/3)");
        eventObj.setResourceType("EPUB_VOLUME");
        eventObj.setName("The Glorious Cause: The American Revolution, 1763-1789 (Oxford History of the United States)");
        eventObj.setDateModified(1402965614516);

        // The target object (frame) within the Event Object
        var targetObj = new Caliper.Frame("https://github.com/readium/readium-js-viewer/book/34843#epubcfi(/4/3/1)");
        targetObj.setResourceType("FRAME");
        targetObj.setName("Key Figures: George Washington");
        targetObj.setDateModified(1402965614516);
        targetObj.setIndex(1);
        targetObj.setIsPartOf(eventObj);

        // The edApp that is part of the Learning Context
        var edApp = new Caliper.SoftwareApplication("https://github.com/readium/readium-js-viewer");
        edApp.setName("Readium");
        edApp.setDateModified(1402965614516);

        // The LIS Course Section for the Caliper Event
        var org = new Caliper.CourseSection("https://some-university.edu/politicalScience/2014/american-revolution-101");
        org.setName("American Revolution 101");
        org.setDateModified(1402965614516);
        org.setCourseNumber("AmRev-101");
        org.setLabel("Am Rev 101");
        org.setSemester("Spring-2014");

        // Specific to the Navigation Event - the location where the user navigated from
        var navigatedFromObj = new Caliper.WebPage("AmRev-101-landingPage");
        navigatedFromObj.setName("American Revolution 101 Landing Page");
        navigatedFromObj.setIsPartOf(org);
        navigatedFromObj.setDateModified(1402965614516);

        // Create the Event
        var navigationEvent = new Caliper.NavigationEvent();
        navigationEvent.setActor(actor);
        navigationEvent.setAction(action);
        navigationEvent.setObject(eventObj);
        navigationEvent.setTarget(targetObj);
        navigationEvent.setEdApp(edApp);
        navigationEvent.setLisOrganization(org);
        navigationEvent.setStartedAtTime(1402965614516);
        navigationEvent.setNavigatedFrom(navigatedFromObj);
        console.log('created navigation event %O', navigationEvent);

        var currentTimeMillis = (new Date()).getTime();

        // Send the Event
        var eventEnvelope = {};
        eventEnvelope['_id'] = 'caliper-js' + currentTimeMillis;
        eventEnvelope.d = navigationEvent;
        console.log('created event envelope %O', eventEnvelope);

        sensor.send(eventEnvelope);

    });
    </script>

</body>

</html>
